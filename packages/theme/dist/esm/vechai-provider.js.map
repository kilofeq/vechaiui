{"version":3,"file":"vechai-provider.js","names":["walkObject","omit","toRGB","deepmerge","React","createContext","useContext","useMemo","set","Global","defaultTheme","toCSSVar","isBrowser","VechaiContext","undefined","displayName","VechaiProvider","theme","colorScheme","density","cssVarsRoot","children","computedTheme","omittedTheme","colors","type","colorSchemes","document","documentElement","classList","add","remove","value","path","rgb","join","normalizedTheme","__cssVars","useVechai","Error","extendTheme","themeOverride","clone"],"sources":["../../src/vechai-provider.tsx"],"sourcesContent":["import {\n  walkObject,\n  omit,\n  toRGB,\n  deepmerge,\n  WithCSSVar,\n  Dict,\n} from \"@vechaiui/utils\";\nimport * as React from \"react\";\nimport { createContext, useContext, useMemo } from \"react\";\nimport set from \"lodash.set\";\nimport { Global } from \"@emotion/react\";\n\nimport { defaultTheme } from \"./default-theme\";\nimport { toCSSVar } from \"./create-theme-vars\";\nimport { isBrowser } from \"./utils\";\nimport { VechaiTheme, VechaiThemeOverride } from \"./types\";\n\ninterface DictVechaiTheme extends Dict {}\n\nexport const VechaiContext = createContext<\n  | {\n      theme: WithCSSVar<DictVechaiTheme>;\n    }\n  | undefined\n>(undefined);\n\nVechaiContext.displayName = \"VechaiContext\";\n\nexport interface VechaiProviderProps {\n  children: React.ReactNode;\n  theme?: VechaiTheme;\n  density?: \"compact\" | \"comfortable\" | \"unset\";\n  colorScheme?: string;\n  cssVarsRoot?: string;\n}\n\nexport function VechaiProvider({\n  theme = defaultTheme,\n  colorScheme = \"light\",\n  density = \"comfortable\",\n  cssVarsRoot = \":host, :root\",\n  children,\n}: VechaiProviderProps) {\n  const computedTheme = useMemo(() => {\n    const omittedTheme = omit(theme, [\"colorSchemes\", \"density\"]);\n    const { colors, type } = theme.colorSchemes[colorScheme] || {};\n    if (isBrowser) {\n      if (type === \"dark\") document.documentElement.classList.add(\"dark\");\n      else document.documentElement.classList.remove(\"dark\");\n    }\n\n    walkObject(colors, (value, path) => {\n      if (typeof value !== \"string\") return;\n      const rgb = toRGB(value);\n      if (rgb) set(colors, path, rgb.join(\",\"));\n    });\n\n    const normalizedTheme = {\n      ...omittedTheme,\n      density: theme.density[density],\n      colors,\n    };\n\n    return toCSSVar(normalizedTheme);\n  }, [theme, colorScheme, density]);\n\n  const value = useMemo(\n    () => ({\n      theme: computedTheme,\n    }),\n    [computedTheme]\n  );\n\n  return (\n    <VechaiContext.Provider value={value}>\n      {/* FIXME: Emotion alernative */}\n      <Global styles={() => ({ [cssVarsRoot]: computedTheme.__cssVars })} />\n      {children}\n    </VechaiContext.Provider>\n  );\n}\n\nexport function useVechai<T extends object = Dict>() {\n  const theme = useContext(\n    (VechaiContext as unknown) as React.Context<T | undefined>\n  );\n  if (!theme) {\n    throw Error(\n      \"useVechai: `theme` is undefined. Seems you forgot to wrap your app in `<VechaiProvider />`\"\n    );\n  }\n\n  return theme as WithCSSVar<T>;\n}\n\nexport function extendTheme(themeOverride: VechaiThemeOverride): VechaiTheme {\n  return deepmerge(defaultTheme, themeOverride, { clone: true }) as VechaiTheme;\n}\n"],"mappings":";AAAA,SACEA,UAAU,EACVC,IAAI,EACJC,KAAK,EACLC,SAAS,QAGJ,iBAAiB;AACxB,OAAO,KAAKC,KAAK,MAAM,OAAO;AAC9B,SAASC,aAAa,EAAEC,UAAU,EAAEC,OAAO,QAAQ,OAAO;AAC1D,OAAOC,GAAG,MAAM,YAAY;AAC5B,SAASC,MAAM,QAAQ,gBAAgB;AAEvC,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,QAAQ,QAAQ,qBAAqB;AAC9C,SAASC,SAAS,QAAQ,SAAS;AAKnC,OAAO,IAAMC,aAAa,gBAAGR,aAAa,CAKxCS,SAAS,CAAC;AAEZD,aAAa,CAACE,WAAW,GAAG,eAAe;AAU3C,OAAO,SAASC,cAAc,OAMN;EAAA,IANO;IAC7BC,KAAK,GAAGP,YAAY;IACpBQ,WAAW,GAAG,OAAO;IACrBC,OAAO,GAAG,aAAa;IACvBC,WAAW,GAAG,cAAc;IAC5BC;EACmB,CAAC;EACpB,IAAMC,aAAa,GAAGf,OAAO,CAAC,MAAM;IAClC,IAAMgB,YAAY,GAAGtB,IAAI,CAACgB,KAAK,EAAE,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;IAC7D,IAAM;MAAEO,MAAM;MAAEC;IAAK,CAAC,GAAGR,KAAK,CAACS,YAAY,CAACR,WAAW,CAAC,IAAI,CAAC,CAAC;IAC9D,IAAIN,SAAS,EAAE;MACb,IAAIa,IAAI,KAAK,MAAM,EAAEE,QAAQ,CAACC,eAAe,CAACC,SAAS,CAACC,GAAG,CAAC,MAAM,CAAC,CAAC,KAC/DH,QAAQ,CAACC,eAAe,CAACC,SAAS,CAACE,MAAM,CAAC,MAAM,CAAC;IACxD;IAEA/B,UAAU,CAACwB,MAAM,EAAE,CAACQ,KAAK,EAAEC,IAAI,KAAK;MAClC,IAAI,OAAOD,KAAK,KAAK,QAAQ,EAAE;MAC/B,IAAME,GAAG,GAAGhC,KAAK,CAAC8B,KAAK,CAAC;MACxB,IAAIE,GAAG,EAAE1B,GAAG,CAACgB,MAAM,EAAES,IAAI,EAAEC,GAAG,CAACC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC3C,CAAC,CAAC;IAEF,IAAMC,eAAe,gBAChBb,YAAY;MACfJ,OAAO,EAAEF,KAAK,CAACE,OAAO,CAACA,OAAO,CAAC;MAC/BK;IAAM,EACP;IAED,OAAOb,QAAQ,CAACyB,eAAe,CAAC;EAClC,CAAC,EAAE,CAACnB,KAAK,EAAEC,WAAW,EAAEC,OAAO,CAAC,CAAC;EAEjC,IAAMa,KAAK,GAAGzB,OAAO,CACnB,OAAO;IACLU,KAAK,EAAEK;EACT,CAAC,CAAC,EACF,CAACA,aAAa,CAAC,CAChB;EAED,oBACE,oBAAC,aAAa,CAAC,QAAQ;IAAC,KAAK,EAAEU;EAAM,gBAEnC,oBAAC,MAAM;IAAC,MAAM,EAAE,OAAO;MAAE,CAACZ,WAAW,GAAGE,aAAa,CAACe;IAAU,CAAC;EAAE,EAAG,EACrEhB,QAAQ,CACc;AAE7B;AAEA,OAAO,SAASiB,SAAS,GAA4B;EACnD,IAAMrB,KAAK,GAAGX,UAAU,CACrBO,aAAa,CACf;EACD,IAAI,CAACI,KAAK,EAAE;IACV,MAAMsB,KAAK,CACT,4FAA4F,CAC7F;EACH;EAEA,OAAOtB,KAAK;AACd;AAEA,OAAO,SAASuB,WAAW,CAACC,aAAkC,EAAe;EAC3E,OAAOtC,SAAS,CAACO,YAAY,EAAE+B,aAAa,EAAE;IAAEC,KAAK,EAAE;EAAK,CAAC,CAAC;AAChE"}