{"version":3,"file":"use-image.js","names":["useImage","props","src","srcSet","onLoad","onError","crossOrigin","sizes","ignoreFallback","useState","status","setStatus","useEffect","imageRef","useRef","load","useCallback","flush","img","Image","srcset","onload","event","onerror","error","current","undefined"],"sources":["../../src/use-image.tsx"],"sourcesContent":["import {\n  ImgHTMLAttributes,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nexport interface UseImageProps {\n  /**\n   * The image `src` attribute\n   */\n  src?: string;\n  /**\n   * The image `srcset` attribute\n   */\n  srcSet?: string;\n  /**\n   * The image `sizes` attribute\n   */\n  sizes?: string;\n  /**\n   * A callback for when the image `src` has been loaded\n   */\n  onLoad?(event: React.SyntheticEvent<HTMLImageElement, Event>): void;\n  /**\n   * A callback for when there was an error loading the image `src`\n   */\n  onError?(error: string | React.SyntheticEvent<HTMLImageElement, Event>): void;\n  /**\n   * If `true`, opt out of the `fallbackSrc` logic and use as `img`\n   */\n  ignoreFallback?: boolean;\n  /**\n   * The key used to set the crossOrigin on the HTMLImageElement into which the image will be loaded.\n   * This tells the browser to request cross-origin access when trying to download the image data.\n   */\n  crossOrigin?: ImgHTMLAttributes<any>[\"crossOrigin\"];\n}\n\ntype Status = \"loading\" | \"failed\" | \"pending\" | \"loaded\";\n\ntype ImageEvent = React.SyntheticEvent<HTMLImageElement, Event>;\n\n/**\n * React hook that loads an image in the browser,\n * and let's us know the `status` so we can show image\n * fallback if it is still `pending`\n *\n * @returns the status of the image loading progress\n *\n * @example\n *\n * ```jsx\n * function App(){\n *   const status = useImage({ src: \"image.png\" })\n *   return status === \"loaded\" ? <img src=\"image.png\" /> : <Placeholder />\n * }\n * ```\n */\nexport function useImage(props: UseImageProps) {\n  const {\n    src,\n    srcSet,\n    onLoad,\n    onError,\n    crossOrigin,\n    sizes,\n    ignoreFallback,\n  } = props;\n\n  const [status, setStatus] = useState<Status>(\"pending\");\n\n  useEffect(() => {\n    setStatus(src ? \"loading\" : \"pending\");\n  }, [src]);\n\n  const imageRef = useRef<HTMLImageElement | null>();\n\n  const load = useCallback(() => {\n    if (!src) return;\n\n    flush();\n\n    const img = new Image();\n\n    img.src = src;\n\n    if (crossOrigin) {\n      img.crossOrigin = crossOrigin;\n    }\n\n    if (srcSet) {\n      img.srcset = srcSet;\n    }\n\n    if (sizes) {\n      img.sizes = sizes;\n    }\n\n    img.onload = (event) => {\n      flush();\n      setStatus(\"loaded\");\n      onLoad?.((event as unknown) as ImageEvent);\n    };\n    img.onerror = (error) => {\n      flush();\n      setStatus(\"failed\");\n      onError?.(error as any);\n    };\n\n    imageRef.current = img;\n  }, [src, crossOrigin, srcSet, sizes, onLoad, onError]);\n\n  const flush = () => {\n    if (imageRef.current) {\n      imageRef.current.onload = null;\n      imageRef.current.onerror = null;\n      imageRef.current = null;\n    }\n  };\n\n  useEffect(() => {\n    /**\n     * If user opts out of the fallback/placeholder\n     * logic, let's bail out.\n     */\n    if (ignoreFallback) return undefined;\n\n    if (status === \"loading\") {\n      load();\n    }\n    return () => {\n      flush();\n    };\n  }, [status, load, ignoreFallback]);\n\n  /**\n   * If user opts out of the fallback/placeholder\n   * logic, let's just return 'loaded'\n   */\n  return ignoreFallback ? \"loaded\" : status;\n}\n\nexport type UseImageReturn = ReturnType<typeof useImage>;\n"],"mappings":";;;;AAAA;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,QAAQ,CAACC,KAAoB,EAAE;EAC7C,IACEC,GAAG,GAODD,KAAK,CAPPC,GAAG;IACHC,MAAM,GAMJF,KAAK,CANPE,MAAM;IACNC,MAAM,GAKJH,KAAK,CALPG,MAAM;IACNC,OAAO,GAILJ,KAAK,CAJPI,OAAO;IACPC,WAAW,GAGTL,KAAK,CAHPK,WAAW;IACXC,KAAK,GAEHN,KAAK,CAFPM,KAAK;IACLC,cAAc,GACZP,KAAK,CADPO,cAAc;EAGhB,gBAA4B,IAAAC,eAAQ,EAAS,SAAS,CAAC;IAAhDC,MAAM;IAAEC,SAAS;EAExB,IAAAC,gBAAS,EAAC,YAAM;IACdD,SAAS,CAACT,GAAG,GAAG,SAAS,GAAG,SAAS,CAAC;EACxC,CAAC,EAAE,CAACA,GAAG,CAAC,CAAC;EAET,IAAMW,QAAQ,GAAG,IAAAC,aAAM,GAA2B;EAElD,IAAMC,IAAI,GAAG,IAAAC,kBAAW,EAAC,YAAM;IAC7B,IAAI,CAACd,GAAG,EAAE;IAEVe,KAAK,EAAE;IAEP,IAAMC,GAAG,GAAG,IAAIC,KAAK,EAAE;IAEvBD,GAAG,CAAChB,GAAG,GAAGA,GAAG;IAEb,IAAII,WAAW,EAAE;MACfY,GAAG,CAACZ,WAAW,GAAGA,WAAW;IAC/B;IAEA,IAAIH,MAAM,EAAE;MACVe,GAAG,CAACE,MAAM,GAAGjB,MAAM;IACrB;IAEA,IAAII,KAAK,EAAE;MACTW,GAAG,CAACX,KAAK,GAAGA,KAAK;IACnB;IAEAW,GAAG,CAACG,MAAM,GAAG,UAACC,KAAK,EAAK;MACtBL,KAAK,EAAE;MACPN,SAAS,CAAC,QAAQ,CAAC;MACnBP,MAAM,oBAANA,MAAM,CAAIkB,KAAK,CAA2B;IAC5C,CAAC;IACDJ,GAAG,CAACK,OAAO,GAAG,UAACC,KAAK,EAAK;MACvBP,KAAK,EAAE;MACPN,SAAS,CAAC,QAAQ,CAAC;MACnBN,OAAO,oBAAPA,OAAO,CAAGmB,KAAK,CAAQ;IACzB,CAAC;IAEDX,QAAQ,CAACY,OAAO,GAAGP,GAAG;EACxB,CAAC,EAAE,CAAChB,GAAG,EAAEI,WAAW,EAAEH,MAAM,EAAEI,KAAK,EAAEH,MAAM,EAAEC,OAAO,CAAC,CAAC;EAEtD,IAAMY,KAAK,GAAG,SAARA,KAAK,GAAS;IAClB,IAAIJ,QAAQ,CAACY,OAAO,EAAE;MACpBZ,QAAQ,CAACY,OAAO,CAACJ,MAAM,GAAG,IAAI;MAC9BR,QAAQ,CAACY,OAAO,CAACF,OAAO,GAAG,IAAI;MAC/BV,QAAQ,CAACY,OAAO,GAAG,IAAI;IACzB;EACF,CAAC;EAED,IAAAb,gBAAS,EAAC,YAAM;IACd;AACJ;AACA;AACA;IACI,IAAIJ,cAAc,EAAE,OAAOkB,SAAS;IAEpC,IAAIhB,MAAM,KAAK,SAAS,EAAE;MACxBK,IAAI,EAAE;IACR;IACA,OAAO,YAAM;MACXE,KAAK,EAAE;IACT,CAAC;EACH,CAAC,EAAE,CAACP,MAAM,EAAEK,IAAI,EAAEP,cAAc,CAAC,CAAC;;EAElC;AACF;AACA;AACA;EACE,OAAOA,cAAc,GAAG,QAAQ,GAAGE,MAAM;AAC3C"}